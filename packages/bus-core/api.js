require("source-map-support/register"),module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=25)}({0:function(e,t){e.exports={filter_request_body(e){const t={};if(e)return function(e,r){for(const n in e)e.hasOwnProperty(n)&&(r.some(e=>n===e)||(t[n]=e[n]));return t}(e,["created_date","updated_date","creator_name","creator_id","last_modifier_name","last_modifier_id","_id"])},compact(e){let t;if("[object Object]"===Object.prototype.toString.call(e)){t={};for(const r in e)e[r]&&(t[r]=e[r])}else"[object Array]"===Object.prototype.toString.call(e)&&(t=[],e.forEach(e=>{e&&t.push(e)}));return t},unless({url:e,method:t},r){function n(e){return!e||Array.isArray(e)?e:[e]}return r.some(function(r){var o=r.methods||n(r.method);return function e(t,r){var n="string"==typeof t&&t===r||t instanceof RegExp&&!!t.exec(r);return t instanceof RegExp&&(t.lastIndex=0),t&&t.url&&(n=e(t.url,r)),n}(r,e)&&function(e,t){return!e||(e=n(e)).indexOf(t)>-1}(o,t)})}}},1:function(e,t){let r={UNKNOW_ERROR:"unknowError",PARAMS_ERROR:"paramsError",RESOURCES_EXIST:"resourcesExist",USER_NOT_PERMISSIONS:"userNotPermissions",RESOURCES_NOT_EXIST:"resourcesNotExist",SERVER_ERROR:"serverError",INVALID_CODE:"invalidCode"};const n=new Map;n.set(r.PARAMS_ERROR,{status:400,message:"Request parameter is wrong"}),n.set(r.RESOURCES_EXIST,{status:400,message:"Data already exists"}),n.set(r.USER_NOT_PERMISSIONS,{status:401,message:"User has no permissions"}),n.set(r.RESOURCES_NOT_EXIST,{status:404,message:"There is no resources"}),n.set(r.SERVER_ERROR,{status:500,message:"Internal Server Error"}),n.set(r.INVALID_CODE,{status:400,message:"Invalid code"}),r.getErrorInfo=(e=>{let t;return e&&(t=n.get(e)),t||(e=r.UNKNOW_ERROR,t=n.get(e)),t}),e.exports=r},2:function(e,t,r){const n=r(1);e.exports=class extends Error{constructor(e,t,r){super();let o="",i="";if(null!==e){const t=n.getErrorInfo(e);o=t.status,i=t.message}else o=t,i=r;this.name=e,this.status=o,this.message=i}}},25:function(e,t,r){function n(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){o(e,t,r[t])})}return e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const i=r(8)(),s=r(26),a=r(0),c=r(27),u=r(2),p=r(1);e.exports=class{constructor(){o(this,"add",e=>{this.datas.push(e)}),o(this,"init",async({models:e,examples:t,hooks:r,config:o})=>{try{s.wrapper(i),i.swagger(Object.assign({title:"Example Server",description:"API 文档",version:"1.0.0",prefix:"/"+(void 0===o.apiPrefix?o.apiPrefix:"api"),swaggerHtmlEndpoint:"/swagger-html",swaggerJsonEndpoint:"/swagger-json",swaggerOptions:{securityDefinitions:{ApiKeyAuth:{type:"apiKey",in:"header",name:"Authorization"}}}},o.swaggerConfig||{}));const l=s.body;s.body=function(){return arguments[0]=a.filter_request_body(arguments[0]),l.apply(this,arguments)};for(const o of this.datas){const{name:l,apiClass:d}=o,f=s.tags([l]);let y={},g={utils:a,examples:t,models:e,tag:f,decorator:s,ApiError:u,ApiErrorNames:p};r.onInitApi&&await r.onInitApi(name,d,g);const{commonApiConfig:m,ApiClass:b}=d(g);m&&(y=c({model:e[l],example:t[l],tag:f,decorator:s,info:n({},m,{pathname:l})})),Object.getOwnPropertyNames(y).filter(e=>!["name","constructor","length","prototype"].includes(e)).forEach(e=>{Object.getOwnPropertyNames(b).indexOf(e)<0&&(b[e]=y[e])}),i.map(b)}return i}catch(e){throw console.warn("Init Apis Error",e),e}}),this.datas=[]}}},26:function(e,t){e.exports=require("koa-swagger-decorator")},27:function(e,t){function r(e,t,r,n,o){var i={};return Object.keys(n).forEach(function(e){i[e]=n[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}e.exports=(({example:e,model:t,tag:n,info:{pathname:o,name:i,baseUrl:s},decorator:{request:a,summary:c,body:u,path:p,description:l,query:d,responses:f}})=>{var y,g,m,b,O,E,_,h,R,w,S,x,j,v,P,I,A,q,D,N,T,C,U,$,M;let z=s||o.replace(/[A-Z]/,e=>e.toLowerCase());function k(e){e.name!==o&&Object.defineProperty(e,"name",{get:()=>o.replace(/^[a-z]/,e=>e.toUpperCase())})}return y=a("GET",`/${z}/{_id}`),g=c(`获取${i}详情`),m=l("_id不能为空"),b=p({_id:{type:"string",required:!0}}),O=f(e),E=a("GET",`/${z}`),_=c(`获取${i}列表`),h=d({page:{type:"number",require:!0,description:"页码"},page_count:{type:"number",require:!0,description:"页数"},filter:{type:"string",description:"过滤条件"}}),R=f({rows:[e],total:{type:"number"}}),w=a("POST",`/${z}`),S=c(`新建${i}`),x=u(e),j=f(e),v=a("PUT",`/${z}/{_id}`),P=c(`修改${i}`),I=p({_id:{type:"string",required:!0}}),A=u(e),q=f(e),D=a("DELETE",`/${z}/{_id}`),N=c(`删除${i}`),T=p({_id:{type:"string",required:!0}}),C=a("DELETE",`/${z}/batch`),U=c(`批量删除${i}`),$=u({ids:{type:"array",required:!0,example:[]}}),r(M=class{static test(){}static async get(e){const{_id:r}=e.params;return t.findById({_id:r}).then(t=>{e.body=t})}static async query(e){const{filter:r}=e.query,n={};r&&(n.name=t.regexp(r));const o=await t.find(n).paging(e.query),i=await t.countDocuments(n);e.body={rows:o,total:i}}static async create(e){return t(e.request.body).save().then(t=>e.body=t)}static async put(e){const{params:{_id:r},request:{body:n}}=e;return console.log("_id",r),t.findByIdAndUpdate(r,n,{new:!0}).then(t=>e.body=t)}static async delete(e){const{params:{_id:r}}=e;return t.findByIdAndRemove(r).then(t=>e.body=t)}static async deleteBatch(e){const{body:{ids:r}}=e.request;return t.deleteMany({_id:{$in:r}}).then(t=>e.body=t)}},"test",[k],Object.getOwnPropertyDescriptor(M,"test"),M),r(M,"get",[k,y,g,m,n,b,O],Object.getOwnPropertyDescriptor(M,"get"),M),r(M,"query",[k,E,_,n,h,R],Object.getOwnPropertyDescriptor(M,"query"),M),r(M,"create",[k,w,S,n,x,j],Object.getOwnPropertyDescriptor(M,"create"),M),r(M,"put",[k,v,P,n,I,A,q],Object.getOwnPropertyDescriptor(M,"put"),M),r(M,"delete",[k,D,N,n,T],Object.getOwnPropertyDescriptor(M,"delete"),M),r(M,"deleteBatch",[k,C,U,n,$],Object.getOwnPropertyDescriptor(M,"deleteBatch"),M),M})},8:function(e,t){e.exports=require("koa-router")}});
//# sourceMappingURL=api.js.map