require("source-map-support/register"),module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=24)}({0:function(e,t){e.exports=require("mongoose")},1:function(e,t){e.exports={filter_request_body(e,t=[]){const r={};if(e)return function(e,t){for(const n in e)e.hasOwnProperty(n)&&(t.some(e=>n===e)||(r[n]=e[n]));return r}(e,t)},compact(e){let t;if("[object Object]"===Object.prototype.toString.call(e)){t={};for(const r in e)e[r]&&(t[r]=e[r])}else"[object Array]"===Object.prototype.toString.call(e)&&(t=[],e.forEach(e=>{e&&t.push(e)}));return t},unless({url:e,method:t},r){function n(e){return!e||Array.isArray(e)?e:[e]}return r.some(function(r){var o=r.methods||n(r.method);return function e(t,r){var n="string"==typeof t&&t===r||t instanceof RegExp&&!!t.exec(r);return t instanceof RegExp&&(t.lastIndex=0),t&&t.url&&(n=e(t.url,r)),n}(r,e)&&function(e,t){return!e||(e=n(e)).indexOf(t)>-1}(o,t)})}}},2:function(e,t){let r={UNKNOW_ERROR:"unknowError",PARAMS_ERROR:"paramsError",RESOURCES_EXIST:"resourcesExist",USER_NOT_PERMISSIONS:"userNotPermissions",RESOURCES_NOT_EXIST:"resourcesNotExist",SERVER_ERROR:"serverError",INVALID_CODE:"invalidCode"};const n=new Map;n.set(r.PARAMS_ERROR,{status:400,message:"Request parameter is wrong"}),n.set(r.RESOURCES_EXIST,{status:400,message:"Data already exists"}),n.set(r.USER_NOT_PERMISSIONS,{status:401,message:"User has no permissions"}),n.set(r.RESOURCES_NOT_EXIST,{status:404,message:"There is no resources"}),n.set(r.SERVER_ERROR,{status:500,message:"Internal Server Error"}),n.set(r.INVALID_CODE,{status:400,message:"Invalid code"}),r.getErrorInfo=(e=>{let t;return e&&(t=n.get(e)),t||(e=r.UNKNOW_ERROR,t=n.get(e)),t}),e.exports=r},24:function(e,t,r){function n(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){o(e,t,r[t])})}return e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const s=r(8)(),i=r(25),a=r(0),c=r(1),u=r(26),p=r(3),l=r(2);e.exports=class{constructor(){o(this,"add",e=>{this.datas.push(e)}),o(this,"init",async({models:e,examples:t,hooks:r,config:o})=>{try{let{apiPrefix:d,bodyExcludeKeys:f}=o;d=d?`/${d}`:"",i.wrapper(s),s.swagger(Object.assign({title:"Example Server",description:"API 文档",version:"1.0.0",prefix:`${d}`,swaggerHtmlEndpoint:"/swagger-html",swaggerJsonEndpoint:"/swagger-json",swaggerOptions:{securityDefinitions:{ApiKeyAuth:{type:"apiKey",in:"header",name:"Authorization"}}}},o.swaggerConfig||{}));const y=i.body;i.body=function(){return arguments[0]=c.filter_request_body(arguments[0],f),y.apply(this,arguments)};for(const o of this.datas){const{name:d,apiClass:f}=o,y=i.tags([d]);let g={},m={utils:c,examples:t,models:e,tag:y,decorator:i,ApiError:p,ApiErrorNames:l,mongoose:a};r.onInitApi&&await r.onInitApi(d,f,m);const{commonApiConfig:b,ApiClass:O}=f(m);b&&(g=u({model:e[d],example:t[d],tag:y,decorator:i,mongoose:a,info:n({},b,{pathname:d})})),Object.getOwnPropertyNames(g).filter(e=>!["name","constructor","length","prototype"].includes(e)).forEach(e=>{Object.getOwnPropertyNames(O).indexOf(e)<0&&(O[e]=g[e])}),s.map(O)}return s}catch(e){throw console.warn("Init Apis Error",e),e}}),this.datas=[]}}},25:function(e,t){e.exports=require("koa-swagger-decorator")},26:function(e,t){function r(e,t,r,n,o){var s={};return Object.keys(n).forEach(function(e){s[e]=n[e]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},s),o&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(o):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}e.exports=(({example:e,model:t,tag:n,info:{pathname:o,name:s,baseUrl:i},decorator:{request:a,summary:c,body:u,path:p,description:l,query:d,responses:f}})=>{var y,g,m,b,O,E,h,_,R,w,S,x,j,v,P,I,q,A,D,N,T,$,C,U,M;let z=i||o.replace(/[A-Z]/,e=>e.toLowerCase());function k(e){e.name!==o&&Object.defineProperty(e,"name",{get:()=>o.replace(/^[a-z]/,e=>e.toUpperCase())})}return y=a("GET",`/${z}/{_id}`),g=c(`获取${s}详情`),m=l("_id不能为空"),b=p({_id:{type:"string",required:!0}}),O=f(e),E=a("GET",`/${z}`),h=c(`获取${s}列表`),_=d({page:{type:"number",require:!0,description:"页码"},page_count:{type:"number",require:!0,description:"页数"},filter:{type:"string",description:"过滤条件"}}),R=f({rows:[e],total:{type:"number"}}),w=a("POST",`/${z}`),S=c(`新建${s}`),x=u(e),j=f(e),v=a("PUT",`/${z}/{_id}`),P=c(`修改${s}`),I=p({_id:{type:"string",required:!0}}),q=u(e),A=f(e),D=a("DELETE",`/${z}/{_id}`),N=c(`删除${s}`),T=p({_id:{type:"string",required:!0}}),$=a("DELETE",`/${z}/batch`),C=c(`批量删除${s}`),U=u({ids:{type:"array",required:!0,example:[]}}),r(M=class{static test(){}static async get(e){const{_id:r}=e.params;return t.findById({_id:r}).then(t=>{e.body=t})}static async query(e){const{filter:r}=e.query,n={};r&&(n.name=t.regexp(r));const o=await t.find(n).paging(e.query),s=await t.countDocuments(n);e.body={rows:o,total:s}}static async create(e){return t(e.request.body).save().then(t=>e.body=t)}static async put(e){const{params:{_id:r},request:{body:n}}=e;return t.findByIdAndUpdate(r,n,{new:!0}).then(t=>e.body=t)}static async delete(e){const{params:{_id:r}}=e;return t.findByIdAndRemove(r).then(t=>e.body=t)}static async deleteBatch(e){const{body:{ids:r}}=e.request;return t.deleteMany({_id:{$in:r}}).then(t=>e.body=t)}},"test",[k],Object.getOwnPropertyDescriptor(M,"test"),M),r(M,"get",[k,y,g,m,n,b,O],Object.getOwnPropertyDescriptor(M,"get"),M),r(M,"query",[k,E,h,n,_,R],Object.getOwnPropertyDescriptor(M,"query"),M),r(M,"create",[k,w,S,n,x,j],Object.getOwnPropertyDescriptor(M,"create"),M),r(M,"put",[k,v,P,n,I,q,A],Object.getOwnPropertyDescriptor(M,"put"),M),r(M,"delete",[k,D,N,n,T],Object.getOwnPropertyDescriptor(M,"delete"),M),r(M,"deleteBatch",[k,$,C,n,U],Object.getOwnPropertyDescriptor(M,"deleteBatch"),M),M})},3:function(e,t,r){const n=r(2);e.exports=class extends Error{constructor(e,t,r){super();let o="",s="";if(null!==e){const t=n.getErrorInfo(e);o=t.status,s=t.message}else o=t,s=r;this.name=e,this.status=o,this.message=s}}},8:function(e,t){e.exports=require("koa-router")}});
//# sourceMappingURL=api.js.map