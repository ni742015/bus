require("source-map-support/register"),module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=25)}({0:function(e,t){e.exports={filter_request_body(e){const t={};if(e)return function(e,r){for(const n in e)e.hasOwnProperty(n)&&(r.some(e=>n===e)||(t[n]=e[n]));return t}(e,["created_date","updated_date","creator_name","creator_id","last_modifier_name","last_modifier_id","_id"])},compact(e){let t;if(console.log("compact",Object.prototype.toString.call(e)),"[object Object]"===Object.prototype.toString.call(e)){t={};for(const r in e)e[r]&&(t[r]=e[r])}else"[object Array]"===Object.prototype.toString.call(e)&&(t=[],e.forEach(e=>{e&&t.push(e)}));return t},unless({url:e,method:t},r){function n(e){return!e||Array.isArray(e)?e:[e]}return r.some(function(r){var o=r.methods||n(r.method);return function e(t,r){var n="string"==typeof t&&t===r||t instanceof RegExp&&!!t.exec(r);return t instanceof RegExp&&(t.lastIndex=0),t&&t.url&&(n=e(t.url,r)),n}(r,e)&&function(e,t){return!e||(e=n(e)).indexOf(t)>-1}(o,t)})}}},1:function(e,t){let r={UNKNOW_ERROR:"unknowError",PARAMS_ERROR:"paramsError",RESOURCES_EXIST:"resourcesExist",USER_NOT_PERMISSIONS:"userNotPermissions",RESOURCES_NOT_EXIST:"resourcesNotExist",SERVER_ERROR:"serverError",INVALID_CODE:"invalidCode"};const n=new Map;n.set(r.PARAMS_ERROR,{status:400,message:"Request parameter is wrong"}),n.set(r.RESOURCES_EXIST,{status:400,message:"Data already exists"}),n.set(r.USER_NOT_PERMISSIONS,{status:401,message:"User has no permissions"}),n.set(r.RESOURCES_NOT_EXIST,{status:404,message:"There is no resources"}),n.set(r.SERVER_ERROR,{status:500,message:"Internal Server Error"}),n.set(r.INVALID_CODE,{status:400,message:"验证码错误"}),r.getErrorInfo=(e=>{let t;return e&&(t=n.get(e)),t||(e=r.UNKNOW_ERROR,t=n.get(e)),t}),e.exports=r},2:function(e,t,r){const n=r(1);e.exports=class extends Error{constructor(e,t,r){super();let o="",s="";if(null!==e){const t=n.getErrorInfo(e);o=t.status,s=t.message}else o=t,s=r;this.name=e,this.status=o,this.message=s}}},25:function(e,t,r){function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const o=r(8)(),s=r(26),i=r(0),a=r(27),c=r(2),u=r(1);e.exports=class{constructor(){n(this,"add",e=>{this.datas.push(e)}),n(this,"init",async({models:e,examples:t,hooks:r,config:n})=>{try{console.log("config.apiPrefix",n.apiPrefix),s.wrapper(o),o.swagger({title:"Example Server",description:"API 文档",version:"1.0.0",prefix:`/${n.apiPrefix}`,swaggerHtmlEndpoint:"/swagger-html",swaggerJsonEndpoint:"/swagger-json",swaggerOptions:{securityDefinitions:{ApiKeyAuth:{type:"apiKey",in:"header",name:"Authorization"}}}});const p=s.body;s.body=function(){return arguments[0]=i.filter_request_body(arguments[0]),p.apply(this,arguments)};for(const n of this.datas){const{name:p,apiClass:d}=n,l=s.tags([p]);let f={},y={utils:i,examples:t,models:e,tag:l,decorator:s,ApiError:c,ApiErrorNames:u};r.onInitApi&&await r.onInitApi(m,d,y);const{name:m,needCommonApi:g,ApiClass:b}=d(y);g&&(f=a({model:e[p],example:t[p],tag:l,decorator:s,info:{name:m,pathname:p}})),Object.getOwnPropertyNames(f).filter(e=>!["name","constructor","length","prototype"].includes(e)).forEach(e=>{Object.getOwnPropertyNames(b).indexOf(e)<0&&(b[e]=f[e])}),o.map(b)}return o}catch(e){throw console.warn("Init Apis Error",e),e}}),this.datas=[]}}},26:function(e,t){e.exports=require("koa-swagger-decorator")},27:function(e,t){function r(e,t,r,n,o){var s={};return Object.keys(n).forEach(function(e){s[e]=n[e]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},s),o&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(o):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}e.exports=(({example:e,model:t,tag:n,info:{pathname:o,name:s},decorator:{request:i,summary:a,body:c,path:u,description:p,query:d,responses:l}})=>{var f,y,m,g,b,O,E,_,h,R,S,x,w,j,P,v,I,A,q,N,T,D,$,C,U;let M=o.replace(/[A-Z]/,e=>`_${e.toLowerCase()}`);function z(e){e.name!==o&&Object.defineProperty(e,"name",{get:()=>o.replace(/^[a-z]/,e=>e.toUpperCase())})}return f=i("GET",`/${M}/{_id}`),y=a(`获取${s}详情`),m=p("_id不能为空"),g=u({_id:{type:"string",required:!0}}),b=l(e),O=i("GET",`/${M}`),E=a(`获取${s}列表`),_=d({page:{type:"number",require:!0,description:"页码"},page_count:{type:"number",require:!0,description:"页数"},filter:{type:"string",description:"过滤条件"}}),h=l({rows:[e],total:{type:"number"}}),R=i("POST",`/${M}`),S=a(`新建${s}`),x=c(e),w=l(e),j=i("PUT",`/${M}/{_id}`),P=a(`修改${s}`),v=u({_id:{type:"ObjectId",required:!0}}),I=c(e),A=l(e),q=i("DELETE",`/${M}/{_id}`),N=a(`删除${s}`),T=u({_id:{type:"ObjectId",required:!0}}),D=i("DELETE",`/${M}/batch`),$=a(`批量删除${s}`),C=c({ids:{type:"array",required:!0,example:[]}}),r(U=class{static test(){}static async get(e){const{_id:r}=e.params;return t.findById({_id:r}).then(t=>{e.body=t})}static async query(e){const{filter:r}=e.query,n={};r&&(n.name=t.regexp(r));const o=await t.find(n).paging(e.query),s=await t.countDocuments(n);e.body={rows:o,total:s}}static async create(e){return t(e.request.body).save().then(t=>e.body=t)}static async put(e){const{params:{_id:r},request:{body:n}}=e;return t.findByIdAndUpdate(r,n,{new:!0}).then(t=>e.body=t)}static async delete(e){const{params:{_id:r}}=e;return t.findByIdAndRemove(r).then(t=>e.body=t)}static async deleteBatch(e){const{body:{ids:r}}=e.request;return t.deleteMany({_id:{$in:r}}).then(t=>e.body=t)}},"test",[z],Object.getOwnPropertyDescriptor(U,"test"),U),r(U,"get",[z,f,y,m,n,g,b],Object.getOwnPropertyDescriptor(U,"get"),U),r(U,"query",[z,O,E,n,_,h],Object.getOwnPropertyDescriptor(U,"query"),U),r(U,"create",[z,R,S,n,x,w],Object.getOwnPropertyDescriptor(U,"create"),U),r(U,"put",[z,j,P,n,v,I,A],Object.getOwnPropertyDescriptor(U,"put"),U),r(U,"delete",[z,q,N,n,T],Object.getOwnPropertyDescriptor(U,"delete"),U),r(U,"deleteBatch",[z,D,$,n,C],Object.getOwnPropertyDescriptor(U,"deleteBatch"),U),U})},8:function(e,t){e.exports=require("koa-router")}});
//# sourceMappingURL=api.js.map